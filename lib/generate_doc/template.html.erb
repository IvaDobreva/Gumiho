<!DOCTYPE html>
<html>
  <head>
  <title>Generated Documentation</title>
  <link rel="stylesheet" type="text/css" href=<%=Gem::Specification.find_by_name("gumiho").gem_dir + "/lib/generate_doc/style/template_style.css" %>>
<!--
  <style>
    
div.main {
width: 1000px;
margin: auto;}

.box {
display: block;
padding: 10px 10px;
font-size: 14px;
color: #1a2f43;
margin: 25px;
background-color:#dddddd;
border-color: black;
border-radius: 5px;}
        
.method {
background-color:#6fc717;
padding: 10px 10px;
border-radius: 5px;
padding: 10px 10px;
color: #fff;
font-weight:bold;}
              
.response_box {
display: block;
padding: 10px;
background-color: white;
height: 250px;
overflow: auto;
border-radius: 5px;}

.params {
border-collapse: collapse; 
width: 100%;
border-bottom: 1px solid #889098;}

.params td, th {border-top: 1px solid #889098;}
  
.failed {
font-weight:bold;
color: #bb132a;
font-size: 16px;}

.method_failed {
background-color:#bb132a;
padding: 10px 10px;
border-radius: 5px;
padding: 10px 10px;
color: #fff;
font-weight:bold;}

.requested_url {
background-color: white;
height: 20px;
border-radius: 5px;
padding: 10px;
overflow: auto;
display: block;}

.description {
display: block;
padding: 12px 0px;}

.response_headers {
background-color: white;
padding: 10px;
height: 100px;
overflow: auto;
border-radius: 5px;
display: block;}

.result {
display: none;}

.response_h {
font-weight: bold;}

.response_code {
display: block;
background-color: white;
padding: 10px;
height: 20px;
overflow: auto;
border-radius: 5px;}

  </style>
    -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    
    <script type="text/javascript">
      toggleResult = function(button) {
        form.find('.result').toggle('slow')
        
        if($(button).html() == 'Hide') {
          $(button).html('Show')
        } else {
          $(button).html('Hide')
        }
      }
    
      tryMe = function(method, url, button){
        form = $(button).parent()
        inputs = form.find('input')
        data = {}
        param_url = url
        inputs.each(function(index) {
    
          if(url.indexOf(':' + $(this).attr('name')) >= 0) {
            url=url.replace(':' + $(this).attr('name'), $(this).val()) 
          } else {
            data[$(this).attr('name')] = $(this).val()
          }
        })
       

        $.ajax({ type: method,
          url: url,
          data: data,
          dataType: 'json', 
          success: function( data, textStatus, jqXHR ){
           
            str = JSON.stringify(data, undefined, 4)
            form.find('.result').show()
            form.find('.requested_url').html(url)
            form.find('.response_box').html(str)
            form.find('.response_headers').html(jqXHR.getAllResponseHeaders())
            form.find('.response_code').html(jqXHR.status)
            
            if(form.find('button[onclick="toggleResult(this)"]').length==0) {
              form.append('<button onclick="toggleResult(this)" type="button">Hide</button>')
            }
          },
          error: function(data) {
            inputs.each(function(index){
              if(param_url.indexOf(':' + $(this).attr('name'))>=0) {
                input_name = 'input[name='+$(this).attr('name')+']'
                form.find(input_name).val('required').css('color', 'red')
              }
            })
            
            inputs.focus(function() {
              if($(this).val()=='required') {
                $(this).animate({color:'red'}, 100, function() {
                  $(this).val('').css('color', 'black')
                })
              }
            })
            
          }
        })
        
      }
     
    </script>
    
  </head>
  
  <body>
    <br>
      <div class="main">
        <ul class="items">
          <% response.each do |res| %>
            <% if check_status(res[:response]) == 'ok' %>
              <li class="box">
                <span class="method"><%= res[:method]  %></span> 
                <span class="url"><b><%= res[:url]  %> </b></span>
                <span class="description"><b>Description:</b> <%=  map_string(res[:response], 'data.description') %> </span>
                <form>
                  <table class ="params">
                    <tr>
                      <th><b>Name</b></th>
                      <th><b>Value</b></th>
                      <th><b>Require</b></th>
                      <th><b>Type</b></th>
                      <th><b>Description</b></th>
                    </tr> 
                    <% map_array(res[:response], 'data.params') do |param_data| %>
                      <tr>
                        <td><%= name = map_string(param_data,'name') %></td>
                        <td><input type="text" name=<%= name %> ></td>
                        <td><%= map_string(param_data,'required') %></td>
                        <td><%= map_string(param_data,'type') %></td>
                        <td><%= map_string(param_data,'desc') %></td>
                      </tr>
                    <% end %>
                  </table>
                  <div class="result">
                    <span class="response_h">Requested url</span>
                    <pre class="requested_url"></pre>
                    <span class="response_h">Response body</span>
                    <pre class="response_box" ></pre>
                    <span class="response_h">Response headers</span>
                    <pre class="response_headers"></pre>
                    <span class="response_h">Response status</span>
                    <pre class='response_code'></pre>
                  </div>
                  <button onclick="tryMe('<%= res[:method] %>', '<%= res[:url] %>', this)" type="button">Try it out</button>
                </form>
              </li>
            <% else %>
              <li class="box">
                <span class="method_failed"><%= res[:method] %></span> 
                <span class="url"><b><%= res[:url] %> </b></span>
                <p class="failed">Request FAILED.</p>
              </li>
            <% end %>
        <% end %>
      </ul>
    </div>
  </body>
</html>
